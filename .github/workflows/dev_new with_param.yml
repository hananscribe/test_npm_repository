name: dev_new_with_parametrs

on: 
    workflow_dispatch:
     inputs:
      enviroment:
        description: 'Choose Enviroment'
        required: true
        default: 'dev'
        
jobs:
 set_environment:
    runs-on: ubuntu-latest
    permissions:
      id-token: write

    strategy:
      matrix:
        environment: ['dev', 'stg', 'prod']

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set Environment
        run: echo "::set-env name=ENVIRONMENT::${{ matrix.environment }}"
  
  
 run_workflow:
      needs: set_environment
      runs-on: ubuntu-latest

      steps:
      - name: Run Workflow
        run: |
          if [[ ${{ env.ENVIRONMENT }} == 'dev' ]]; then
            # Actions for the 'dev' environment
          elif [[ ${{ env.ENVIRONMENT }} == 'stg' ]]; then
            # Actions for the 'stg' environment
          elif [[ ${{ env.ENVIRONMENT }} == 'prod' ]]; then
            # Actions for the 'prod' environment
          fi
        env:
          DEV_SECRET_KEY: ${{ secrets.DEV_SECRET_KEY }}
          STG_SECRET_KEY: ${{ secrets.STG_SECRET_KEY }}
          PROD_SECRET_KEY: ${{ secrets.PROD_SECRET_KEY }}

   
    # steps: 
    #   - uses: actions/checkout@v2
    #     with:
    #       fetch-depth: 0
     
          

      # - name: Read Configuration File
      #   run: |
      #     CONFIG_FILE="dev_config.yml"
      #     while IFS= read -r line
      #     do
      #      key=$(echo "$line" | awk -F: '{print $1}')
      #      value=$(echo "$line" | awk -F: '{print $2}')
      #      export "$key=$value"
      #     done < "$CONFIG_FILE"

      # - name: Display Environment Variables
      #   run: |
      #     echo "scribe-client-id = $scribe-client-id"
      #     echo "scribe-client-secret = $scribe-client-secret"   
         
#       - name: Scm generate bom, upload to scribe
#         id: valint_bom_scm
#         uses: scribe-security/action-bom@master
# #         uses: scribe-security/action-bom@dev
#         with:
#           type: dir
#           target: ./
#           verbose: 2
#           scribe-enable: true
#           # scribe-client-id: ${{ secrets.SCRIBE_DEV_NEW_CLIENT_ID}}
#           scribe-client-id: ${{ secrets.scribe-client-id}}
#           scribe-client-secret: scribe-client-secret
#           # scribe-client-secret: ${{ secrets.SCRIBE_DEV_NEW_CLIENT_SECRET }}
#           product-key: "000_my_npm_repos"
#           scribe-url: ${{ env.SCRIBE_URL }}
#           scribe-login-url: ${{ env.SCRIBE_LOGIN_URL }}
#           scribe-audience: ${{ env.SCRIBE_AUDIENCE }}

#       - name: build image
#         run: |
#           docker build -t my-image:latest .
       
#       - name: Read JSON file and set custom_env
#         id: set_custom_env
#         run: echo "custom_env=$(cat my_metdata.json)" >> $GITHUB_ENV
# #         run: echo "custom_env=$(cat ${{inputs.my_input_value)}}" >> $GITHUB_ENV
      
#       - name: Image generate bom, upload to scribe
#         id: valint_bom_image
#         uses: scribe-security/action-bom@master
# #         uses: scribe-security/action-bom@dev
#         with:
#           type: docker
#           target: my-image:latest
#           verbose: 2
#           format: attest
#           scribe-enable: true
#           scribe-client-id: ${{ secrets.SCRIBE_DEV_NEW_CLIENT_ID }}
#           scribe-client-secret: ${{ secrets.SCRIBE_DEV_NEW_CLIENT_SECRET }}
#           product-key: "0000_my_npm_repos"
#           scribe-url: ${{ env.SCRIBE_URL }}
#           scribe-login-url: ${{ env.SCRIBE_LOGIN_URL }}
#           scribe-audience: ${{ env.SCRIBE_AUDIENCE }}
#           app-name: $LOGICAL_APP_NAME
#           app-version: $APP_VERSION
#           author-name: $AUTHOR_NAME
#           author-email: $AUTHOR_EMAIL
#           author-phone: $AUTHOR_PHONE
#           supplier-name: $SUPPLIER_NAME
#           supplier-url: $SUPPLIER_URL
#           supplier-email: $SUPPLIER_EMAIL 
#           supplier-phone: $SUPPLIER_PHONE
#           env: user_metadata
#           force: true
#         env:
#           user_metadata: ${{ env.custom_env }}
# #           DEBUG: true
